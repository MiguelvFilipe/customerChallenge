<div class="main-customer-container">
  <section>
    <button nz-button [nzType]="'primary'" (click)="showCreationModal()"><span>Create Customer</span></button>
    <nz-modal 
    nzClassName="create-customer-modal" 
    [(nzVisible)]="isVisible" 
    nzTitle="Create New Customer" 
    (nzOnCancel)="handleCreationCancel()" 
    (nzOnOk)="onCreateCustomer()"
    nzOkText="Create Customer">
    >
      <ng-container *nzModalContent>
          <div class="input-container">
            <label>First Name</label>
            <input nz-input placeholder="Customer first name" [(ngModel)]="newCustomer.firstName" type="text" required [class.invalid]="formErrors.newCustomer.firstName" />
           <!--  <input type="text" [(ngModel)]="newCustomer.firstName" required [class.invalid]="formErrors.newCustomer.firstName" /> -->
            <div *ngIf="formErrors.newCustomer.firstName" class="error-message">{{ formErrors.newCustomer.firstName }}</div>
          </div>
          <div class="input-container">
            <label>Last Name</label>
            <input nz-input placeholder="Customer last name" [(ngModel)]="newCustomer.lastName" type="text" required [class.invalid]="formErrors.newCustomer.lastName" />
          <!--   <input type="text" [(ngModel)]="newCustomer.lastName" required [class.invalid]="formErrors.newCustomer.lastName" /> -->
            <div *ngIf="formErrors.newCustomer.lastName" class="error-message">{{ formErrors.newCustomer.lastName }}</div>
          </div>
          <div class="input-container">
            <label>Birth Date:</label>
            <nz-date-picker [(ngModel)]="newCustomer.birthDate" (ngModelChange)="onBirthDateChange($event)"></nz-date-picker>
          </div>
          <div class="input-container">
            <label>Email:</label>
            <input nz-input placeholder="Email" [(ngModel)]="newCustomer.email" type="email" [class.invalid]="formErrors.newCustomer.email"/>
            <div *ngIf="formErrors.newCustomer.email" class="error-message">{{ formErrors.newCustomer.email }}</div>
          </div>
          <div class="input-container">
            <label>
              Has Contract
              <nz-switch [(ngModel)]="newCustomer.hasContract"></nz-switch>
            </label>
          </div>
       
      </ng-container>
    </nz-modal>

    <!-- Edit Customer Modal -->
    <nz-modal 
      nzClassName="edit-customer-modal" 
      [(nzVisible)]="isEditModalVisible" 
      nzTitle="Edit Customer" 
      (nzOnCancel)="handleEditCancel()" 
      (nzOnOk)="handleEditOk()"
      nzOkText="Update Customer">
      <ng-container *nzModalContent>
        <div class="input-container" *ngIf="editCustomer">
          <label>First Name</label>
          <input nz-input placeholder="Customer first name" [(ngModel)]="editCustomer.firstName" type="text" required [class.invalid]="formErrors.editCustomer.firstName" />
          <div *ngIf="formErrors.editCustomer.firstName" class="error-message">{{ formErrors.editCustomer.firstName }}</div>
        </div>
        <div class="input-container" *ngIf="editCustomer">
          <label>Last Name</label>
          <input nz-input placeholder="Customer last name" [(ngModel)]="editCustomer.lastName" type="text" required [class.invalid]="formErrors.editCustomer.lastName" />
          <div *ngIf="formErrors.editCustomer.lastName" class="error-message">{{ formErrors.editCustomer.lastName }}</div>
        </div>
        <div class="input-container" *ngIf="editCustomer">
          <label>Birth Date:</label>
          <nz-date-picker [(ngModel)]="editCustomer.birthDate"></nz-date-picker>
        </div>
        <div class="input-container" *ngIf="editCustomer">
          <label>Email:</label>
          <input nz-input placeholder="Email" [(ngModel)]="editCustomer.email" type="email" [class.invalid]="formErrors.editCustomer.email"/>
          <div *ngIf="formErrors.editCustomer.email" class="error-message">{{ formErrors.editCustomer.email }}</div>
        </div>
        <div class="input-container" *ngIf="editCustomer">
          <label>
            Has Contract
            <nz-switch [(ngModel)]="editCustomer.hasContract"></nz-switch>
          </label>
        </div>
      </ng-container>
    </nz-modal>
    
    <!-- Delete Confirmation Modal -->
    <nz-modal
      nzClassName="delete-customer-modal"
      [(nzVisible)]="isDeleteModalVisible"
      nzTitle="Confirm Delete"
      (nzOnCancel)="handleDeleteCancel()"
      (nzOnOk)="confirmDelete()"
      nzOkText="Delete"
    >
      <ng-container *nzModalContent>
        <p>Are you sure you want to delete this customer? This action cannot be undone.</p>
      </ng-container>
    </nz-modal>
  </section>
  <section class="customer-table-container">
   
      <div *ngIf="noDataMessage">{{ noDataMessage }}</div>
      <nz-table 
        #customerTable 
        [nzData]="customerList?.customerList || []" 
        *ngIf="!noDataMessage"
        [nzLoading]="isLoading"
        [nzFrontPagination]="true"
        [nzShowPagination]="false"
        [nzShowSizeChanger]="true"
        [nzPageSizeOptions]="[2, 5, 10]"
        (nzPageSizeChange)="onLimitChange($event)"
        class="table-container"
     
      >
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Birth Date</th>
            <th>Contract Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let customer of customerTable.data" (click)="onCustomerClick(customer.id)" style="cursor: pointer;">
            <td>
              {{ customer.firstName }} {{ customer.lastName }}
            <!--   <span *ngIf="isBirthdayThisMonth(customer.birthDate)">ðŸŽ‚</span> -->
              <span *ngIf="customer.birthDate && isBirthdayThisMonth(customer.birthDate)">ðŸŽ‚</span>
            </td>
            <td>{{ customer.email }}</td>
            <td>{{ customer.birthDate }}</td>
            <td>{{ customer.hasContract ? 'Active' : 'None' }}</td>
            <td>
              <button nz-button nzType="primary" nzShape="circle"><span nz-icon nzType="edit" (click)="$event.stopPropagation(); onEditCustomer(customer.id)"></span></button>
              <nz-divider nzType="vertical"></nz-divider>
              <button nz-button nzDanger nzShape="circle"><span nz-icon nzType="delete" nzTheme="fill" (click)="$event.stopPropagation(); onDeleteCustomer(customer.id)"></span></button>
            </td>
          </tr>
        </tbody>
      </nz-table>
    
      
      <div class="custom-pagination" style="display: flex; justify-content: center; margin-top: 16px;">
        <button (click)="onPrevPage()" [disabled]="isLoading || currentPage === 1">Previous</button>
        <span style="margin: 0 10px;">Page {{ currentPage }}</span>
        <button (click)="onNextPage()" [disabled]="isLoading || !hasMoreData">Next</button>
        <select [(ngModel)]="limit" (change)="onLimitChange(limit)" [disabled]="isLoading" style="margin-left: 10px;">
          <option value="2">2</option>
          <option value="5">5</option>
          <option value="10">10</option>
        </select>
      </div>
    
  </section>
</div>


<!-- <div class="teste">
<div *ngIf="errorMessage">{{ errorMessage }}</div>
<div>
  
  <button nz-button nzType="primary" nzShape="circle"><span nz-icon nzType="search"></span></button>
  <button nz-button nzType="primary" nzShape="circle">A</button>
  <button nz-button nzType="primary">
    <span nz-icon nzType="search"></span>
    Search
  </button>
  <button nz-button nzType="default" nzShape="circle"><span nz-icon nzType="search"></span></button>
  <button nz-button nzType="default">
    <span nz-icon nzType="search"></span>
    Search
  </button>
  <br />
  <button nz-button nzType="default" nzShape="circle"><span nz-icon nzType="search"></span></button>
  <button nz-button nzType="default">
    <span nz-icon nzType="search"></span>
    Search
  </button>
  <button nz-button nzType="dashed" nzShape="circle"><span nz-icon nzType="search"></span></button>
  <button nz-button nzType="dashed">
    <span nz-icon nzType="search"></span>
    Search
  </button>
  <nz-input-group nzSearch nzSize="large" [nzAddOnAfter]="suffixButton">
    <input type="text" nz-input placeholder="input search text" />
  </nz-input-group>
  <ng-template #suffixButton>
    <button nz-button nzType="primary" nzSize="large" nzSearch>Search</button>
  </ng-template>
  
 

  <button (click)="onPrevPage()" [disabled]="isLoading || currentPage === 1">Previous</button>
  <span>Page {{ currentPage }}</span>
  <button (click)="onNextPage()" [disabled]="isLoading || !hasMoreData">Next</button>
  <select [(ngModel)]="limit" (change)="onLimitChange(limit)" [disabled]="isLoading">
    <option value="2">2</option>
    <option value="5">5</option>
    <option value="10">10</option>
  </select>
</div>
<div>
  <label>
    <input type="checkbox" [(ngModel)]="showHasContract" (change)="onShowHasContractChange()" />
    Show Only Customers with Contract
  </label>
</div>
<div>
  <input type="text" [(ngModel)]="searchQuery" placeholder="Search by first or last name" />
  <select [(ngModel)]="searchType">
    <option value="firstName">First Name</option>
    <option value="lastName">Last Name</option>
  </select>
  <button (click)="onSearch()" [disabled]="isLoading">Search</button>
  <button (click)="clearSearch()" [disabled]="isLoading || !isInSearchMode">Clear Search</button>
</div>
<div>
  <button (click)="refreshData()" [disabled]="isLoading">Refresh Data</button>
</div>


<div class="customer-list-container" style="position: relative; min-height: 100px;">
  <div *ngIf="noDataMessage">{{ noDataMessage }}</div>
  
  <nz-table 
    #customerTable 
    [nzData]="customerList?.customerList || []" 
    *ngIf="!noDataMessage"
    [nzLoading]="isLoading"
    [nzFrontPagination]="true"
    [nzShowPagination]="false"
    [nzShowSizeChanger]="true"
    [nzPageSizeOptions]="[2, 5, 10]"
    (nzPageSizeChange)="onLimitChange($event)"
  >
    <thead>
      <tr>
        <th>Name</th>
        <th>Email</th>
        <th>Birth Date</th>
        <th>Contract Status</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let customer of customerTable.data" (click)="onCustomerClick(customer.id)" style="cursor: pointer;">
        <td>
          {{ customer.firstName }} {{ customer.lastName }}
          <span *ngIf="isBirthdayThisMonth(customer.birthDate)">ðŸŽ‚</span>
        </td>
        <td>{{ customer.email }}</td>
        <td>{{ customer.birthDate }}</td>
        <td>{{ customer.hasContract ? 'Active' : 'None' }}</td>
        <td>
          <button (click)="$event.stopPropagation(); onEditCustomer(customer.id)">Edit</button>
          <nz-divider nzType="vertical"></nz-divider>
          <button (click)="$event.stopPropagation(); onDeleteCustomer(customer.id)">Delete</button>
        </td>
      </tr>
    </tbody>
  </nz-table>

  
  <div class="custom-pagination" style="display: flex; justify-content: center; margin-top: 16px;">
    <button (click)="onPrevPage()" [disabled]="isLoading || currentPage === 1">Previous</button>
    <span style="margin: 0 10px;">Page {{ currentPage }}</span>
    <button (click)="onNextPage()" [disabled]="isLoading || !hasMoreData">Next</button>
    <select [(ngModel)]="limit" (change)="onLimitChange(limit)" [disabled]="isLoading" style="margin-left: 10px;">
      <option value="2">2</option>
      <option value="5">5</option>
      <option value="10">10</option>
    </select>
  </div>
</div>


<div *ngIf="editCustomer">
  <h2>Edit Customer</h2>
  <div>
    <label>First Name:</label>
    <input type="text" [(ngModel)]="editCustomer.firstName" required [class.invalid]="formErrors.editCustomer.firstName" />
    <div *ngIf="formErrors.editCustomer.firstName" class="error-message">{{ formErrors.editCustomer.firstName }}</div>
  </div>
  <div>
    <label>Last Name:</label>
    <input type="text" [(ngModel)]="editCustomer.lastName" required [class.invalid]="formErrors.editCustomer.lastName" />
    <div *ngIf="formErrors.editCustomer.lastName" class="error-message">{{ formErrors.editCustomer.lastName }}</div>
  </div>
  <div>
    <label>Birth Date:</label>
    <input type="date" [(ngModel)]="editCustomer.birthDate" />
  </div>
  <div>
    <label>Email:</label>
    <input type="email" [(ngModel)]="editCustomer.email" [class.invalid]="formErrors.editCustomer.email" />
    <div *ngIf="formErrors.editCustomer.email" class="error-message">{{ formErrors.editCustomer.email }}</div>
  </div>
  <div>
    <label>Avatar URL:</label>
    <input type="text" [(ngModel)]="editCustomer.avatar" />
  </div>
  <div>
    <label>
      <input type="checkbox" [(ngModel)]="editCustomer.hasContract" />
      Has Contract
    </label>
  </div>
  <button (click)="onUpdateCustomer()">Update Customer</button>
  <button (click)="resetEditCustomerForm()">Cancel</button>
</div>


<div>
  <h2>Create New Customer</h2>
  <div>
    <label>First Name:</label>
    <input type="text" [(ngModel)]="newCustomer.firstName" required [class.invalid]="formErrors.newCustomer.firstName" />
    <div *ngIf="formErrors.newCustomer.firstName" class="error-message">{{ formErrors.newCustomer.firstName }}</div>
  </div>
  <div>
    <label>Last Name:</label>
    <input type="text" [(ngModel)]="newCustomer.lastName" required [class.invalid]="formErrors.newCustomer.lastName" />
    <div *ngIf="formErrors.newCustomer.lastName" class="error-message">{{ formErrors.newCustomer.lastName }}</div>
  </div>
  <div>
    <label>Birth Date:</label>
    <input type="date" [(ngModel)]="newCustomer.birthDate" />
  </div>
  <div>
    <label>Email:</label>
    <input type="email" [(ngModel)]="newCustomer.email" [class.invalid]="formErrors.newCustomer.email" />
    <div *ngIf="formErrors.newCustomer.email" class="error-message">{{ formErrors.newCustomer.email }}</div>
  </div>
  <div>
    <label>Avatar URL:</label>
    <input type="text" [(ngModel)]="newCustomer.avatar" />
  </div>
  <div>
    <label>
      <input type="checkbox" [(ngModel)]="newCustomer.hasContract" />
      Has Contract
    </label>
  </div>
  <button (click)="onCreateCustomer()">Create Customer</button>
</div>

</div> -->